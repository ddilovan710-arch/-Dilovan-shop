<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ğŸ’° Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ØªØ¬Ø±</title>
  <style>
    body { font-family: "Cairo", sans-serif; margin:0; background:#f5f6fa; direction:rtl; font-size:20px; }
    header { background:#2c3e50; color:white; padding:25px; text-align:center; font-size:28px; }
    nav { display:flex; justify-content:center; gap:20px; background:#34495e; padding:15px; flex-wrap:wrap; }
    nav button { background:#1abc9c; border:none; color:white; padding:20px 40px; border-radius:12px; cursor:pointer; font-size:22px; font-weight:bold; }
    nav button:hover { background:#16a085; }
    section { display:none; max-width:1000px; margin:30px auto; background:white; padding:30px; border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,0.15); font-size:22px; }
    section.active { display:block; }
    label { display:block; margin-top:15px; font-weight:bold; font-size:22px; }
    input,button,select { margin:8px 0; padding:18px; border-radius:10px; border:1px solid #bbb; width:100%; box-sizing:border-box; font-size:22px; }
    button.action { background:#3498db; color:white; border:none; width:100%; font-size:24px; font-weight:bold; }
    button.action:hover { background:#2980b9; }
    table { width:100%; border-collapse:collapse; margin-top:20px; font-size:20px; }
    th,td { border:1px solid #ddd; padding:12px; text-align:center; }
    th { background:#ecf0f1; font-size:22px; }
    #scanner { display:none; margin:15px auto; width:320px; height:320px; position:relative; border-radius:12px; overflow:hidden; background:#000; }
    .scan-box{ position:absolute; width:86%; height:32%; left:7%; top:34%; border:3px solid #00e5ff; border-radius:10px; pointer-events:none; }
    .scan-line{ position:absolute; left:8%; width:84%; height:2px; background:#ff3b3b; box-shadow:0 0 8px #ff3b3b, 0 0 16px #ff3b3b; animation: sweep 1.3s linear infinite; }
    @keyframes sweep{ 0%{ top:36%; } 100%{ top:64%; } }
    #lastScan { text-align:center; font-size:24px; margin-top:10px; font-weight:bold; color:#2c3e50; }
    .btn-sm { padding:10px 20px; font-size:20px; margin:5px; border-radius:8px; cursor:pointer; }
    .edit { background:#f39c12; color:white; border:none; }
    .delete { background:#e74c3c; color:white; border:none; }
    .searchBox{ margin:15px 0; display:flex; gap:10px; flex-wrap:wrap; }
    .searchBox input{ flex:1; }
  </style>
</head>
<body>
  <header>ğŸ’° Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ØªØ¬Ø±</header>
  <nav>
    <button onclick="showPage('sell')">ğŸ’µ Ø§Ù„Ø¨ÙŠØ¹</button>
    <button onclick="showPage('products')">ğŸ›’ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
    <button onclick="showPage('profit')">ğŸ“ˆ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</button>
    <button onclick="showPage('history')">ğŸ“Š Ø§Ù„Ø³Ø¬Ù„</button>
  </nav>

  <!-- ØµÙØ­Ø© Ø§Ù„Ø¨ÙŠØ¹ -->
  <section id="sell" class="active">
    <h2>ğŸ’µ Ø¨ÙŠØ¹ Ù…Ù†ØªØ¬</h2>
    <div class="searchBox">
      <input id="searchInput" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
      <button class="btn-sm" onclick="startScanner('search')">ğŸ“· Ù…Ø³Ø­</button>
      <button class="btn-sm" onclick="searchPage()">ğŸ” Ø¨Ø­Ø«</button>
    </div>
    <div id="searchResult"></div>
    <label>ğŸ“¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</label>
    <input id="sellBarcode" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
    <button class="btn-sm" onclick="startScanner('sell')">ğŸ“· Ù…Ø³Ø­ Ø¨Ø§Ø±ÙƒÙˆØ¯</button>
    <button class="action" onclick="showSellModal()">âœ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨ÙŠØ¹</button>
  </section>

  <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
  <section id="products">
    <h2>ğŸ›’ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
    <div class="searchBox">
      <input id="searchInput" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
      <button class="btn-sm" onclick="startScanner('search')">ğŸ“· Ù…Ø³Ø­</button>
      <button class="btn-sm" onclick="searchPage()">ğŸ” Ø¨Ø­Ø«</button>
    </div>
    <div id="searchResult"></div>
    <label>ğŸ’² Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ©</label>
    <input id="pprice" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ©">
    <label>ğŸ“¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</label>
    <input id="pbarcode" placeholder="Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
    <button class="btn-sm" onclick="startScanner('product')">ğŸ“· Ù…Ø³Ø­ Ø¨Ø§Ø±ÙƒÙˆØ¯</button>
    <label>ğŸ”¢ Ø§Ù„ÙƒÙ…ÙŠØ©</label>
    <input id="pstock" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
    <button class="action" onclick="addOrUpdateProduct()">â• Ø¥Ø¶Ø§ÙØ© / ØªØ­Ø¯ÙŠØ«</button>
    <button class="btn-sm" onclick="openImportModal('products')">ğŸ“¦ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>

    <h2>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
    <p>ğŸ’° Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ÙƒÙ„ÙŠØ© Ù„Ù„Ø¨Ø¶Ø§Ø¹Ø©: <span id="inventoryValue">0</span></p>
    <table id="productsTable">
      <thead><tr><th>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th><th>Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ©</th><th>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</th><th>Ø®ÙŠØ§Ø±Ø§Øª</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- ØµÙØ­Ø© Ø§Ù„Ø±Ø¨Ø­ -->
  <section id="profit">
    <h2>ğŸ“ˆ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</h2>
    <p>ğŸ’µ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: <span id="totalSales">0</span></p>
    <p>ğŸ“¦ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©: <span id="totalCost">0</span></p>
    <p>âœ… ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: <span id="netProfit">0</span></p>
  </section>

  <!-- ØµÙØ­Ø© Ø§Ù„Ø³Ø¬Ù„ -->
  <section id="history">
    <h2>ğŸ“Š Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h2>
    <div class="searchBox">
      <input id="searchInput" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
      <button class="btn-sm" onclick="startScanner('search')">ğŸ“· Ù…Ø³Ø­</button>
      <button class="btn-sm" onclick="searchPage()">ğŸ” Ø¨Ø­Ø«</button>
    </div>
    <div id="searchResult"></div>
    <button class="btn-sm" onclick="openImportModal('history')">ğŸ“¦ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
    <table id="historyTable">
      <thead><tr><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ø³ØªÙŠØ±Ø§Ø¯ -->
  <div id="importModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:999;">
    <div style="background:#fff; padding:25px; border-radius:12px; width:400px; text-align:center;">
      <h3>ğŸ“¦ Ø¹Ù…Ù„ÙŠØ© Ø§Ø³ØªÙŠØ±Ø§Ø¯</h3>
      <label>ğŸ“¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</label>
      <input id="importBarcode" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯">
      <button class="btn-sm" onclick="startScanner('import')">ğŸ“· Ù…Ø³Ø­</button>
      <label>ğŸ”¢ Ø§Ù„ÙƒÙ…ÙŠØ©</label>
      <input id="importQty" type="number" value="1">
      <button class="action" onclick="processImport()">âœ… Ø­ÙØ¸</button>
      <button class="btn-sm delete" onclick="closeImportModal()">âŒ Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨ÙŠØ¹ -->
  <div id="sellModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:999;">
    <div style="background:#fff; padding:25px; border-radius:12px; width:400px; text-align:center;">
      <h3>ğŸ›’ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h3>
      <p id="sellInfo"></p>
      <label>ğŸ’² Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</label>
      <input id="modalSellPrice" type="number">
      <label>ğŸ”¢ Ø§Ù„ÙƒÙ…ÙŠØ©</label>
      <input id="modalSellQty" type="number" value="1">
      <button class="action" onclick="confirmSale()">âœ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨ÙŠØ¹</button>
      <button class="btn-sm delete" onclick="closeSellModal()">âŒ Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>

  <!-- Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ -->
  <div id="scanner">
    <div class="scan-box"><div class="scan-line"></div></div>
  </div>
  <div id="lastScan"></div>
  <audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
  <script>
    let products = JSON.parse(localStorage.getItem("products") || "[]");
    let transactions = JSON.parse(localStorage.getItem("transactions") || "[]");
    let scannerMode = null;
    let importSource="products";

    function saveData(){ localStorage.setItem("products", JSON.stringify(products)); localStorage.setItem("transactions", JSON.stringify(transactions)); }
    function loadProducts(){ const tbody=document.querySelector("#productsTable tbody"); tbody.innerHTML=""; let total=0; products.forEach(p=>{ tbody.innerHTML+=`<tr><td>${p.barcode}</td><td>${p.price}</td><td>${p.stock}</td><td><button class="btn-sm edit" onclick="editProduct('${p.barcode}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button><button class="btn-sm delete" onclick="deleteProduct('${p.barcode}')">ğŸ—‘ï¸ Ø­Ø°Ù</button></td></tr>`; total+=p.price*p.stock; }); document.getElementById("inventoryValue").textContent=total.toFixed(2); }
    function addOrUpdateProduct(){ const price=parseFloat(document.getElementById("pprice").value)||0; const barcode=document.getElementById("pbarcode").value.trim(); const stock=parseInt(document.getElementById("pstock").value)||0; if(!barcode) return alert("âŒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯"); let p=products.find(x=>x.barcode===barcode); if(p){ p.price=price||p.price; p.stock+=stock; } else { products.push({barcode,price,stock}); } saveData(); loadProducts(); }
    function editProduct(b){ let p=products.find(x=>x.barcode===b); if(!p) return; document.getElementById("pbarcode").value=p.barcode; document.getElementById("pprice").value=p.price; document.getElementById("pstock").value=p.stock; showPage("products"); }
    function deleteProduct(b){ products=products.filter(p=>p.barcode!==b); saveData(); loadProducts(); }
    function recordTransaction(b,q,pr){ let p=products.find(x=>x.barcode===b)||{price:0}; transactions.push({type:"Ø¨ÙŠØ¹",barcode:b,qty:q,price:pr,total:pr*q,cost:p.price*q,date:new Date().toLocaleString()}); saveData();}
    function processTransaction(b,q,pr){ let p=products.find(x=>x.barcode===b); if(!p) return alert("âŒ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"); if(p.stock<q) return alert("âŒ Ù…Ø®Ø²ÙˆÙ† ØºÙŠØ± ÙƒØ§ÙÙŠ"); p.stock-=q; recordTransaction(b,q,pr); saveData(); loadProducts(); alert("âœ” ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹"); }
    function calcProfit(){ let s=0,c=0; transactions.forEach(t=>{s+=t.price*t.qty;c+=t.cost;}); document.getElementById("totalSales").textContent=s.toFixed(2); document.getElementById("totalCost").textContent=c.toFixed(2); document.getElementById("netProfit").textContent=(s-c).toFixed(2);}
    function loadHistory(){ const tbody=document.querySelector("#historyTable tbody"); tbody.innerHTML=""; transactions.forEach(t=>{ tbody.innerHTML+=`<tr><td>${t.type}</td><td>${t.barcode}</td><td>${t.qty}</td><td>${t.price}</td><td>${t.total}</td><td>${t.date}</td></tr>`; }); }
    function showPage(id){ document.querySelectorAll("section").forEach(s=>s.classList.remove("active")); document.getElementById(id).classList.add("active"); if(id==="products") loadProducts(); if(id==="profit") calcProfit(); if(id==="history") loadHistory(); }

    // Ø§Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„ØµÙØ­Ø©
    function searchPage(){
      const code=document.getElementById("searchInput").value.trim();
      if(!code) return;
      const active=document.querySelector("section.active").id;
      let res="";
      if(active==="sell"){ let p=products.find(x=>x.barcode===code); res = p ? `ğŸ’² Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ (Ø£Ø¯Ø®Ù„Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§) - Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${p.stock}` : "âŒ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"; }
      if(active==="products"){ let p=products.find(x=>x.barcode===code); res = p ? `âœ… Ù…ÙˆØ¬ÙˆØ¯: Ø¨Ø§Ø±ÙƒÙˆØ¯ ${p.barcode}, Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ© ${p.price}, Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ${p.stock}` : "âŒ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"; }
      if(active==="history"){ let logs=transactions.filter(t=>t.barcode===code); if(logs.length===0) res="âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª"; else res=logs.map(t=>`${t.type} - ÙƒÙ…ÙŠØ© ${t.qty} - Ø¨ØªØ§Ø±ÙŠØ® ${t.date}`).join("<br>"); }
      document.getElementById("searchResult").innerHTML=res;
    }

    // Ø§Ø³ØªÙŠØ±Ø§Ø¯
    function openImportModal(src){ importSource=src; document.getElementById("importModal").style.display="flex"; }
    function closeImportModal(){ document.getElementById("importModal").style.display="none"; }
    function processImport(){ const b=document.getElementById("importBarcode").value.trim(); const q=parseInt(document.getElementById("importQty").value)||0; if(!b || q<=0) return alert("âŒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); let p=products.find(x=>x.barcode===b); if(importSource==="products"){ if(p){ p.stock+=q; } else{ products.push({barcode:b,price:0,stock:q}); } } transactions.push({type:"Ø§Ø³ØªÙŠØ±Ø§Ø¯",barcode:b,qty:q,price:0,total:0,cost:0,date:new Date().toLocaleString()}); saveData(); loadProducts(); loadHistory(); closeImportModal(); alert("âœ” ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯"); }

    // Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨ÙŠØ¹
    function showSellModal(){ const b=document.getElementById("sellBarcode").value; let p=products.find(x=>x.barcode===b); if(!p) return alert("âŒ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"); document.getElementById("sellInfo").innerHTML=`Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ${p.barcode}<br>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${p.stock}<br>Ø§Ù„ØªÙƒÙ„ÙØ©: ${p.price}`; document.getElementById("sellModal").style.display="flex"; }
    function closeSellModal(){ document.getElementById("sellModal").style.display="none"; }
    function confirmSale(){ const b=document.getElementById("sellBarcode").value; const q=parseInt(document.getElementById("modalSellQty").value)||0; const pr=parseFloat(document.getElementById("modalSellPrice").value)||0; let p=products.find(x=>x.barcode===b); if(!p || p.stock<q) return alert("âŒ Ù…Ø®Ø²ÙˆÙ† ØºÙŠØ± ÙƒØ§ÙÙŠ"); p.stock-=q; recordTransaction(b,q,pr); saveData(); loadProducts(); loadHistory(); alert("âœ” ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹"); closeSellModal(); }

    // Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    function startScanner(mode){ scannerMode=mode; const scanner=document.getElementById("scanner"); scanner.style.display="block"; document.getElementById("lastScan").textContent="ğŸ“· Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø³Ø­..."; try{Quagga.stop();}catch(e){} Quagga.init({ inputStream:{type:"LiveStream",constraints:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}},target:scanner, area:{top:"34%",right:"7%",left:"7%",bottom:"34%"}}, decoder:{readers:["code_128_reader","ean_reader","ean_8_reader","upc_reader","code_39_reader","code_93_reader","i2of5_reader"]}, locate:true },err=>{ if(err){console.error(err);return;} Quagga.start(); }); Quagga.onDetected(d=>{ let code=d.codeResult.code;
